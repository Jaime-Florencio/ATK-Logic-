# 2.14.1 Adicionar Protocolo

O ATK-Logic permite adicionar protocolos de comunica√ß√£o para decodifica√ß√£o de sinais seriais, como **UART, I¬≤C, SPI e CAN**. Essa funcionalidade facilita a an√°lise de barramentos digitais em conjunto com as formas de onda coletadas.

---

## Passo a Passo

### 1. Acessar o menu de protocolos
Na barra lateral direita do software, clique em **Protocol Decoding ‚Üí Protocol**.  
Ser√° exibida a lista de protocolos suportados. Passe o mouse sobre cada um para ver a descri√ß√£o,  
ou clique no nome para abrir a interface de configura√ß√£o.
![√çcone para adicionar protocolo](../assets/protocol_add_icon.png)

![√çcone para adicionar protocolo](../assets/protocol_selection_uart.png)

---

### 2. Configura√ß√£o inicial do protocolo
Selecione o protocolo desejado (ex.: UART, I¬≤C, SPI, CAN) e defina as op√ß√µes b√°sicas.

Quando selecionamos o protocolo desejado (por exemplo, **UART**), a janela **Protocol Settings** √© exibida, permitindo configurar os par√¢metros necess√°rios para a decodifica√ß√£o.  
Os campos dispon√≠veis t√™m a seguinte fun√ß√£o:

![Janela de configura√ß√£o do protocolo UART](../assets/protocol_selection_uart_UART2.png)

- **RX (UART receive line)** ‚Üí Canal usado para **receber dados**. Selecione qual canal do analisador l√≥gico est√° conectado ao pino **RX** do dispositivo.  
- **TX (UART transmit line)** ‚Üí Canal usado para **transmitir dados**. Selecione o canal conectado ao pino **TX** do dispositivo. Pode ficar em branco se for apenas recep√ß√£o.  
- **Baud rate** ‚Üí Taxa de transmiss√£o em **bits por segundo (bps)**. Ex.: 9600, 115200. Deve coincidir com o dispositivo.  
- **Data bits** ‚Üí N√∫mero de bits por palavra de dados. Valores t√≠picos: **7** ou **8**.  
- **Parity** ‚Üí M√©todo opcional de detec√ß√£o de erros: **none** (sem paridade), **even** (paridade par), **odd** (paridade √≠mpar).  
- **Stop bits** ‚Üí N√∫mero de bits de parada ap√≥s cada palavra. Normalmente **1.0** ou **2.0**.  
- **Bit order** ‚Üí Ordem dos bits: **lsb-first** (menos significativo primeiro) ou **msb-first** (mais significativo primeiro).  
- **Data format** ‚Üí Formato de exibi√ß√£o dos dados: **hex**, **bin** ou **ascii**.  
- **Invert RX** ‚Üí Inverte a polaridade do sinal RX. √ötil quando o dispositivo trabalha com l√≥gica invertida.  
- **Start / End** ‚Üí Define o intervalo da captura onde a decodifica√ß√£o ser√° aplicada.  
- **Bot√µes (Cancel / OK)** ‚Üí  
  - **Cancel** descarta as altera√ß√µes.  
  - **OK** confirma as configura√ß√µes e adiciona o protocolo √† lista ativa.  

---

### 3. Decoded Data Display
![UART decoded data table](../assets/protocol_uart_decoded_table.png)

**Detalhe da tabela de dados:**  
Al√©m da sobreposi√ß√£o direta dos caracteres no sinal (RX/TX data), o ATK-Logic apresenta cada evento em uma lista organizada chamada **Data Interface**.  

Essa tabela exibe:  
- **Start** ‚Üí instante exato de in√≠cio do bit ou caractere.  
- **Time** ‚Üí dura√ß√£o do bit/intervalo.  
- **Type** ‚Üí se √© RX ou TX, e se corresponde a bits ou dados.  
- **Data** ‚Üí conte√∫do interpretado (por exemplo: `Start bit`, `1`, `0`, ou caracteres ASCII).  

üîé Essa vis√£o detalhada √© √∫til para depura√ß√£o precisa, pois permite correlacionar o tempo exato de cada bit com a representa√ß√£o l√≥gica e os caracteres recebidos/enviados.

- **Especificar regi√£o de decodifica√ß√£o**:  
  Na interface **Protocol Settings**, na parte inferior, √© poss√≠vel definir a regi√£o
  de decodifica√ß√£o dos dados configurando os marcadores *Start* e *End*.  
  Isso ajuda a economizar tempo ao limitar a an√°lise apenas ao trecho desejado.
  
![Mapeamento de Canais](../assets/protocol_channel_mapping.png)
  
  - **Filtragem dos dados na forma de onda**:  
  Clique no bot√£o **Protocol Settings** em **Op√ß√µes do Canal** (Channel Options).  
  Em **Show**, selecione apenas os dados decodificados que deseja exibir.  
  Isso simplifica a interface da forma de onda, deixando vis√≠veis apenas as
  informa√ß√µes relevantes.

![Ajustes de Par√¢metros](../assets/protocol_parameter_settings.png)

![Resultados da Decodifica√ß√£o](../assets/protocol_decode_result.png)

- **Bloqueio da Linha de Protocolo**:  
  Por padr√£o, as linhas de protocolo se adaptam automaticamente para exibir os
  dados decodificados e, se n√£o houver protocolo na √°rea de forma de onda,
  essas linhas s√£o ocultadas.  
  Por√©m, ao ativar a op√ß√£o de **bloqueio da linha**, a posi√ß√£o das linhas de
  protocolo permanece fixa e vis√≠vel, mesmo quando n√£o h√° protocolo exibido.  

  ![Bloqueio da Linha de Protocolo](../assets/protocol_row_lock.png)

- **Exibi√ß√£o de listas de resultados decodificados**:  
  Ao adicionar m√∫ltiplos protocolos simultaneamente (por exemplo, **UART** e **SPI**),
  os dados decodificados podem n√£o aparecer todos na mesma lista.  
  Para simplificar a visualiza√ß√£o, √© poss√≠vel escolher quais protocolos exibir indo em:  
  **Protocol Decoding** -> **Data** -> **More**.  

  ![Exibi√ß√£o de Resultados M√∫ltiplos](../assets/protocol_multi_results.png)

- **Filtragem dos resultados decodificados**:  
  Por padr√£o, os resultados decodificados s√£o exibidos com todas as informa√ß√µes
  do protocolo selecionado. Para simplificar a lista, √© poss√≠vel escolher quais
  tipos de dados exibir em:  
  **Protocol Decoding** -> **Data** -> **More** -> **Display Rows**.  

  üí° **Dica √∫til**: ao dar um **duplo clique** em uma linha da lista, o software
  navega rapidamente at√© o ponto correspondente na forma de onda, facilitando
  a an√°lise.  

  ![Filtragem de Resultados Decodificados](../assets/protocol_result_filter.png)

- **Busca nos resultados decodificados**:  
  √â poss√≠vel pesquisar diretamente dentro da lista de resultados decodificados,
  digitando o conte√∫do desejado na caixa de busca (**n√£o diferencia mai√∫sculas
  de min√∫sculas**).  

  O recurso suporta:  
  - Pesquisa por **tipo** (ex.: RX data, TX data, RX bits).  
  - Pesquisa por **conte√∫do da coluna Data** (ex.: "Start bit", "1", "0", caracteres ASCII).  
  - **Sintaxe avan√ßada de busca**, permitindo filtros mais refinados.  

  ![Busca em Resultados Decodificados](../assets/protocol_result_search.png)

- **Busca avan√ßada com sintaxe**:  
  O ATK-Logic suporta operadores especiais para refinar a pesquisa nos resultados
  decodificados:  

  - **`!!`** ‚Üí significa *diferente de* (exclui um termo).  
  - **`&&`** ‚Üí significa *condi√ß√µes paralelas* (combina√ß√£o de termos).  

  **Exemplo:**  
  Se for necess√°rio buscar dados de texto que contenham `"alientek"` mas **n√£o**
  contenham `"stop"`, a express√£o ser√°:  
  ```
  alientek&&!!stop
  ```
  
‚ö†Ô∏è **Observa√ß√£o:** essa pesquisa √© **sens√≠vel a s√≠mbolos e espa√ßos**, portanto
a express√£o deve ser escrita exatamente como esperado.

### 4. Tips and Small Features

> **Customizar resultados exibidos na decodifica√ß√£o de protocolos**:  
> Selecione **Protocol Settings** -> **Show** e marque apenas os resultados que deseja exibir.  
> Isso permite esconder informa√ß√µes irrelevantes e manter a interface mais limpa.  

![Customizar Resultados](../assets/icon_protocol_settings.png)

![Exibi√ß√£o Personalizada](../assets/protocol_custom_display.png)

---

> **Filtragem da lista de dados decodificados**:  
> Escolha **Protocol Decoding** -> **Data Filtering** e selecione os tipos de dados que deseja visualizar.  
> Assim √© poss√≠vel focar apenas em pacotes ou valores espec√≠ficos, ignorando avisos ou bits redundantes.  

![Abrir Filtro](../assets/protocol_view_follow.png)

![Filtrar Lista](../assets/protocol_list_filter.png)

---

> **Exportar dados decodificados**:  
> Selecione **Protocol Decoding** -> **Export Table** para exportar os dados da tabela atual.  
> Esse recurso √© √∫til para documentar testes ou analisar os dados em softwares externos (ex.: Excel).  
> üí° *Dica: pode ser usado em conjunto com a filtragem, exportando apenas os dados relevantes.*  

![Abrir Exporta√ß√£o](../assets/protocol_view_follow.png)

![Exportar Tabela](../assets/protocol_export_table.png)

---

> **Fun√ß√£o ‚ÄúView Following‚Äù**:  
> Selecione **Protocol Decoding** -> **View Following**.  
> Ao ativar, a rolagem da interface de visualiza√ß√£o √© sincronizada com a lista de dados decodificados.  
> Isso garante que waveform e tabela fiquem sempre alinhados, facilitando a an√°lise detalhada.  

![Abrir View Following](../assets/protocol_view_follow.png)

![View Following](../assets/protocol_view_follow.png)


---

#### 4.1 Protocol Settings

O **ATK-Logic** suporta mais de **170 protocolos**.  
Para ajudar os usu√°rios a compreender rapidamente os par√¢metros de configura√ß√£o
de cada protocolo, est√° dispon√≠vel uma documenta√ß√£o online com detalhes completos:

üîó **Documenta√ß√£o Online:**  
[ATK-Logic Protocol Documentation](http://www.openedv.com/ATK-Prod/ATK-Logic/docs/index.html)

> ‚ÑπÔ∏è Observa√ß√£o: a documenta√ß√£o online ser√° continuamente atualizada, incluindo novos protocolos e ajustes de par√¢metros.

---

#### 4.2 Custom Protocol Development

Embora o software suporte mais de **170 decodificadores de protocolos**
comumente utilizados, ainda pode n√£o atender √†s necessidades espec√≠ficas de alguns usu√°rios.  
Por esse motivo, disponibilizamos um guia para auxiliar na **adi√ß√£o de novos protocolos personalizados**.

üîó **Documenta√ß√£o Online para Desenvolvimento Secund√°rio:**  
[Custom Protocol Development Guide](http://www.openedv.com/ATK-Prod/ATK-Logic/docs/index.html)

> ‚ÑπÔ∏è Observa√ß√£o: a documenta√ß√£o online √© atualizada de forma cont√≠nua, garantindo suporte √†s novas demandas de protocolos.

---

#### 4.3 Protocol Debugging

O **ATK-Logic** fornece uma funcionalidade dedicada para **depura√ß√£o de protocolos personalizados**.  
Para acess√°-la, v√° em **Function -> Settings** na barra superior esquerda e selecione **Decoder**.  

O processo de depura√ß√£o ocorre em tr√™s etapas principais:

---

> **Abrir interface de configura√ß√µes e definir n√≠vel de log**  
Altere o campo **Decoder log level** para `Spew`.  
Esse modo mostra mensagens detalhadas, ideais para rastrear problemas de configura√ß√£o.  

![Configurar n√≠vel de Log](../assets/protocol_log_level.png)

---

> **Abrir a janela Debug Log**  
Clique em **Debug log** para visualizar as mensagens geradas durante a an√°lise.  
Aqui ser√£o exibidos avisos, erros e informa√ß√µes internas do decodificador.  

![Abrir janela Debug Log](../assets/protocol_debug_log_button.png)

---

> **Recarregar a biblioteca de protocolos**  
Ap√≥s criar ou modificar um protocolo, clique em **Reload Protocol Library**.  
Em seguida, confira o log para identificar poss√≠veis erros.  

‚ö†Ô∏è *Nota:* se voc√™ tiver alterado par√¢metros de protocolo, linhas de exibi√ß√£o ou outros conte√∫dos, pode ser necess√°rio **remover e re-adicionar** o protocolo. A simples reinterpreta√ß√£o nem sempre aplica as mudan√ßas corretamente.  

![Janela de Depura√ß√£o Completa](../assets/protocol_debug_window.png)

